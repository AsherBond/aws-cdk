"use strict";var n=Object.defineProperty;var l=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var u=Object.prototype.hasOwnProperty;var R=(e,t)=>{for(var s in t)n(e,s,{get:t[s],enumerable:!0})},x=(e,t,s,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of N(t))!u.call(e,a)&&a!==s&&n(e,a,{get:()=>t[a],enumerable:!(o=l(t,a))||o.enumerable});return e};var I=e=>x(n({},"__esModule",{value:!0}),e);var g={};R(g,{isCompleteHandler:()=>P,onEventHandler:()=>b});module.exports=I(g);var m=require("@aws-sdk/client-glue"),r=new m.Glue({});async function b(e){console.log(`Event: ${JSON.stringify({...e,ResponseURL:"..."})}`);let t=e.ResourceProperties.DatabaseName,s=e.ResourceProperties.TableName,o=e.ResourceProperties.IndexName,a=e.RequestType;switch(a){case"Create":case"Update":await y(e);break;case"Delete":await f(e);break}return a==="Create"||a==="Update"?{PhysicalResourceId:`${t}-${s}-${o}`}:{}}async function P(e){console.log(`Event: ${JSON.stringify({...e,ResponseURL:"..."})}`);let t=e.ResourceProperties.TableName,s=e.ResourceProperties.DatabaseName,o=e.ResourceProperties.IndexName,a=await r.getPartitionIndexes({TableName:t,DatabaseName:s});console.log(`Get partition indexes: ${JSON.stringify(a)}`);let c=(a.PartitionIndexDescriptorList??[]).find(d=>d.IndexName===o),p=c?.IndexStatus==="ACTIVE";switch(e.RequestType){case"Create":case"Update":return{IsComplete:p};case"Delete":return{IsComplete:c===void 0}}}async function y(e){let t=e.ResourceProperties.TableName,s=e.ResourceProperties.DatabaseName,o=e.ResourceProperties.IndexName,a=e.ResourceProperties.Keys,i=await r.createPartitionIndex({TableName:t,DatabaseName:s,PartitionIndex:{IndexName:o,Keys:a}});console.log(`Create partition index: ${JSON.stringify(i)}`)}async function f(e){let t=e.ResourceProperties.TableName,s=e.ResourceProperties.DatabaseName,o=e.ResourceProperties.IndexName,a=await r.deletePartitionIndex({TableName:t,DatabaseName:s,IndexName:o});console.log(`Delete partition index: ${JSON.stringify(a)}`)}0&&(module.exports={isCompleteHandler,onEventHandler});
